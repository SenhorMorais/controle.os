<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Gest√£o de O.S</title>
    
    <!-- Favicon -->
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>‚öôÔ∏è</text></svg>">

    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: linear-gradient(135deg, #0f172a 0%, #312e81 50%, #0f172a 100%);
            min-height: 100vh;
            padding: 1rem;
        }
        .container { max-width: 1200px; margin: 0 auto; }
        .header { text-align: center; margin-bottom: 2rem; }
        .header h1 { color: white; font-size: 2.5rem; font-weight: bold; margin-bottom: 0.5rem; }
        .header p { color: #c7d2fe; font-size: 1rem; }
        .stats-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 1rem; margin-bottom: 2rem; }
        .stat-card {
            background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%);
            border-radius: 1rem;
            padding: 1.5rem;
            color: white;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
        }
        .stat-card p { font-size: 0.875rem; opacity: 0.9; margin-bottom: 0.5rem; }
        .stat-card h2 { font-size: 2.5rem; font-weight: bold; }
        .stat-card.green { background: linear-gradient(135deg, #10b981 0%, #059669 100%); }
        .stat-card.purple { background: linear-gradient(135deg, #8b5cf6 0%, #7c3aed 100%); }
        .card {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 1rem;
            padding: 1.5rem;
            border: 1px solid rgba(255, 255, 255, 0.2);
            margin-bottom: 2rem;
        }
        .card h2 { color: white; font-size: 1.5rem; margin-bottom: 1.5rem; font-weight: bold; }
        .form-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 1rem; margin-bottom: 1rem; }
        .form-group { display: flex; flex-direction: column; }
        .form-group label { color: #c7d2fe; font-size: 0.875rem; margin-bottom: 0.5rem; font-weight: 500; }
        .form-group input, .form-group select, .form-group textarea {
            background: rgba(255, 255, 255, 0.2);
            border: 1px solid rgba(255, 255, 255, 0.3);
            border-radius: 0.75rem;
            padding: 0.75rem 1rem;
            color: white;
            font-size: 1rem;
            transition: all 0.3s ease;
        }
        .form-group input:focus, .form-group select:focus, .form-group textarea:focus {
            outline: none;
            border-color: #6366f1;
            background: rgba(255, 255, 255, 0.25);
        }
        .form-group textarea { min-height: 100px; resize: vertical; font-family: inherit; }
        .btn-group { display: flex; gap: 0.75rem; margin-top: 1.5rem; flex-wrap: wrap; }
        .btn {
            padding: 0.75rem 1.5rem;
            border: none;
            border-radius: 0.75rem;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            transition: all 0.3s ease;
        }
        .btn:hover { transform: translateY(-2px); box-shadow: 0 10px 20px rgba(0, 0, 0, 0.3); }
        .btn-primary { background: linear-gradient(135deg, #6366f1 0%, #8b5cf6 100%); color: white; }
        .btn-secondary { background: rgba(255, 255, 255, 0.2); color: white; }
        .btn-danger { background: rgba(239, 68, 68, 0.8); color: white; }
        .orders-list { display: grid; gap: 1rem; }
        .order-card {
            background: rgba(255, 255, 255, 0.1);
            padding: 1.25rem;
            border-radius: 0.75rem;
            border: 1px solid rgba(255, 255, 255, 0.1);
            transition: all 0.3s ease;
        }
        .order-card:hover { transform: translateY(-4px); box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3); }
        .order-header { display: flex; gap: 1rem; margin-bottom: 0.75rem; flex-wrap: wrap; align-items: center; }
        .order-number { color: white; font-size: 1.5rem; font-weight: bold; }
        .status-badge {
            padding: 0.375rem 0.75rem;
            border-radius: 9999px;
            font-size: 0.75rem;
            font-weight: 600;
            text-transform: uppercase;
        }
        .status-aberta { background: rgba(156,163,175,0.3); color: #d1d5db; }
        .status-andamento { background: rgba(59,130,246,0.3); color: #93c5fd; }
        .status-pausada { background: rgba(251,191,36,0.3); color: #fde047; }
        .status-concluida { background: rgba(16,185,129,0.3); color: #6ee7b7; }
        .status-cancelada { background: rgba(239,68,68,0.3); color: #fca5a5; }
        
        /* Gr√°fico personalizado */
        .chart-container {
            position: relative;
            width: 100%;
            max-width: 400px;
            margin: 0 auto;
        }
        .donut-chart {
            width: 100%;
            height: auto;
        }
        .chart-legend {
            display: flex;
            justify-content: center;
            gap: 2rem;
            margin-top: 1.5rem;
            flex-wrap: wrap;
        }
        .legend-item {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            color: white;
            font-size: 0.9rem;
        }
        .legend-color {
            width: 20px;
            height: 20px;
            border-radius: 4px;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>‚öôÔ∏è Gest√£o de O.S</h1>
            <p>Controle r√°pido e eficiente de ordens de servi√ßo</p>
        </div>

        <!-- Estat√≠sticas -->
        <div class="stats-grid">
            <div class="stat-card">
                <p>Total de O.S</p>
                <h2 id="totalOS">0</h2>
            </div>
            <div class="stat-card green">
                <p>Conclu√≠das</p>
                <h2 id="totalConcluidas">0</h2>
            </div>
            <div class="stat-card purple">
                <p>Hoje</p>
                <h2 id="totalHoje">0</h2>
            </div>
        </div>

        <!-- Formul√°rio -->
        <div class="card">
            <h2 id="formTitle">‚ûï Nova O.S</h2>
            <div class="form-grid">
                <div class="form-group">
                    <label>N¬∫ da O.S *</label>
                    <input type="text" id="numeroOS" placeholder="Ex: OS-001" />
                </div>
                <div class="form-group">
                    <label>Data *</label>
                    <input type="date" id="data" />
                </div>
            </div>
            <div class="form-group">
                <label>Descri√ß√£o *</label>
                <textarea id="descricao" placeholder="Descreva os detalhes da ordem de servi√ßo..."></textarea>
            </div>
            <div class="form-grid">
                <div class="form-group">
                    <label>Hora In√≠cio</label>
                    <input type="time" id="horaInicio" />
                </div>
                <div class="form-group">
                    <label>Hora Fim</label>
                    <input type="time" id="horaFim" />
                </div>
                <div class="form-group">
                    <label>Status *</label>
                    <select id="status">
                        <option value="Aberta">Aberta</option>
                        <option value="Em Andamento">Em Andamento</option>
                        <option value="Pausada">Pausada</option>
                        <option value="Conclu√≠da">Conclu√≠da</option>
                        <option value="Cancelada">Cancelada</option>
                    </select>
                </div>
            </div>
            <div class="btn-group">
                <button class="btn btn-primary" onclick="saveOrder()">
                    üíæ <span id="btnText">Salvar</span>
                </button>
                <button class="btn btn-secondary" id="btnCancel" onclick="cancelEdit()" style="display:none;">
                    ‚ùå Cancelar
                </button>
            </div>
        </div>

        <!-- FILTRO POR M√äS -->
        <div class="card">
            <h2>üîé Filtro por M√™s</h2>
            <div class="form-grid">
                <div class="form-group">
                    <label>Filtrar por M√™s</label>
                    <input type="month" id="filtroMes" />
                </div>
                <div class="form-group">
                    <label>&nbsp;</label>
                    <button class="btn btn-primary" onclick="filtrarMes()">üîç Buscar</button>
                </div>
            </div>
        </div>

        <!-- Dias sem O.S -->
        <div class="card">
            <h2>üìÖ Dias sem O.S</h2>
            <ul id="diasSemOs" style="color:#c7d2fe; padding-left:1.5rem; line-height: 1.8;">
                <li>Selecione um m√™s para visualizar</li>
            </ul>
        </div>

        <!-- Gr√°fico -->
        <div class="card">
            <h2>üìä Gr√°fico de Apontamento (%)</h2>
            <div class="chart-container">
                <svg class="donut-chart" viewBox="0 0 200 200" id="graficoApontamento">
                    <circle cx="100" cy="100" r="80" fill="none" stroke="#10b981" stroke-width="40" stroke-dasharray="0 502.4" transform="rotate(-90 100 100)" id="circleCom"/>
                    <circle cx="100" cy="100" r="80" fill="none" stroke="#ef4444" stroke-width="40" stroke-dasharray="502.4 502.4" transform="rotate(-90 100 100)" id="circleSem"/>
                    <text x="100" y="100" text-anchor="middle" dy="0.3em" fill="white" font-size="32" font-weight="bold" id="percentText">0%</text>
                </svg>
                <div class="chart-legend">
                    <div class="legend-item">
                        <div class="legend-color" style="background: #10b981;"></div>
                        <span>Dias com OS</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-color" style="background: #ef4444;"></div>
                        <span>Dias sem OS</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- Lista -->
        <div class="card">
            <h2>üìã Ordens Cadastradas (<span id="orderCount">0</span>)</h2>
            <div class="orders-list" id="ordersList"></div>
        </div>
    </div>

    <script>
        let orders = [];
        let editingId = null;

        // Carrega as ordens do localStorage
        function loadOrders() {
            const saved = localStorage.getItem('ordens-servico');
            if (saved) {
                try {
                    orders = JSON.parse(saved);
                } catch (e) {
                    console.error('Erro ao carregar ordens:', e);
                    orders = [];
                }
            }
            renderOrders();
            updateStats();
        }

        // Salva no localStorage
        function saveToStorage() {
            localStorage.setItem('ordens-servico', JSON.stringify(orders));
        }

        // Calcula dura√ß√£o entre dois hor√°rios
        function calculateDuration(inicio, fim) {
            if (!inicio || !fim) return '-';
            const [h1, m1] = inicio.split(':').map(Number);
            const [h2, m2] = fim.split(':').map(Number);
            const total = (h2 * 60 + m2) - (h1 * 60 + m1);
            if (total < 0) return '-';
            const horas = Math.floor(total / 60);
            const minutos = total % 60;
            return `${horas}h ${minutos}m`;
        }

        // Salva ou atualiza uma ordem
        function saveOrder() {
            const numOS = document.getElementById('numeroOS').value.trim();
            const desc = document.getElementById('descricao').value.trim();
            const dt = document.getElementById('data').value;
            const inicio = document.getElementById('horaInicio').value;
            const fim = document.getElementById('horaFim').value;
            const stat = document.getElementById('status').value;

            if (!numOS || !desc || !dt) {
                alert('‚ö†Ô∏è Preencha os campos obrigat√≥rios (N¬∫ OS, Descri√ß√£o e Data)');
                return;
            }

            const order = {
                id: editingId || Date.now(),
                numeroOS: numOS,
                descricao: desc,
                data: dt,
                horaInicio: inicio,
                horaFim: fim,
                status: stat
            };

            if (editingId) {
                const index = orders.findIndex(o => o.id === editingId);
                if (index !== -1) {
                    orders[index] = order;
                }
            } else {
                orders.push(order);
            }

            saveToStorage();
            renderOrders();
            updateStats();
            clearForm();
        }

        // Edita uma ordem existente
        function editOrder(id) {
            const o = orders.find(o => o.id === id);
            if (!o) return;

            document.getElementById('numeroOS').value = o.numeroOS;
            document.getElementById('descricao').value = o.descricao;
            document.getElementById('data').value = o.data;
            document.getElementById('horaInicio').value = o.horaInicio || '';
            document.getElementById('horaFim').value = o.horaFim || '';
            document.getElementById('status').value = o.status;

            editingId = id;
            document.getElementById('formTitle').textContent = '‚úèÔ∏è Editar O.S';
            document.getElementById('btnText').textContent = 'Atualizar';
            document.getElementById('btnCancel').style.display = 'block';
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        // Exclui uma ordem
        function deleteOrder(id) {
            if (confirm('üóëÔ∏è Deseja realmente excluir esta O.S?')) {
                orders = orders.filter(o => o.id !== id);
                saveToStorage();
                renderOrders();
                updateStats();
            }
        }

        // Cancela edi√ß√£o
        function cancelEdit() {
            clearForm();
        }

        // Limpa o formul√°rio
        function clearForm() {
            document.getElementById('numeroOS').value = '';
            document.getElementById('descricao').value = '';
            document.getElementById('data').value = '';
            document.getElementById('horaInicio').value = '';
            document.getElementById('horaFim').value = '';
            document.getElementById('status').value = 'Aberta';
            editingId = null;
            document.getElementById('formTitle').textContent = '‚ûï Nova O.S';
            document.getElementById('btnText').textContent = 'Salvar';
            document.getElementById('btnCancel').style.display = 'none';
        }

        // Renderiza a lista de ordens
        function renderOrders(lista = orders) {
            const cont = document.getElementById('ordersList');
            document.getElementById('orderCount').textContent = lista.length;

            if (lista.length === 0) {
                cont.innerHTML = '<div style="color:#c7d2fe; text-align:center; padding:2rem;">Nenhuma ordem cadastrada</div>';
                return;
            }

            cont.innerHTML = lista.map(order => {
                const cls = {
                    'Aberta': 'status-aberta',
                    'Em Andamento': 'status-andamento',
                    'Pausada': 'status-pausada',
                    'Conclu√≠da': 'status-concluida',
                    'Cancelada': 'status-cancelada'
                }[order.status] || 'status-aberta';

                const dataObj = new Date(order.data + 'T00:00:00');
                const dataFormatada = dataObj.toLocaleDateString('pt-BR');

                return `<div class='order-card'>
                    <div class='order-header'>
                        <span class='order-number'>${order.numeroOS}</span>
                        <span class='status-badge ${cls}'>${order.status}</span>
                    </div>
                    <div style='color:#c7d2fe; margin-top:0.5rem;'>${order.descricao}</div>
                    <div style='color:#c7d2fe; margin-top:0.75rem; font-size:0.9rem;'>
                        üìÖ ${dataFormatada}<br>
                        ${order.horaInicio ? 'üïê In√≠cio: ' + order.horaInicio + '<br>' : ''}
                        ${order.horaFim ? 'üïê Fim: ' + order.horaFim + '<br>' : ''}
                        ${(order.horaInicio && order.horaFim) ? '‚è± Dura√ß√£o: ' + calculateDuration(order.horaInicio, order.horaFim) : ''}
                    </div>
                    <div style='margin-top:1rem; display:flex; gap:0.5rem; flex-wrap:wrap;'>
                        <button class='btn btn-secondary' style='padding:0.5rem 1rem;' onclick='editOrder(${order.id})'>‚úèÔ∏è Editar</button>
                        <button class='btn btn-danger' style='padding:0.5rem 1rem;' onclick='deleteOrder(${order.id})'>üóëÔ∏è Excluir</button>
                    </div>
                </div>`;
            }).join('');
        }

        // Atualiza as estat√≠sticas
        function updateStats() {
            document.getElementById('totalOS').textContent = orders.length;
            document.getElementById('totalConcluidas').textContent = orders.filter(o => o.status === 'Conclu√≠da').length;
            const hoje = new Date().toISOString().split('T')[0];
            document.getElementById('totalHoje').textContent = orders.filter(o => o.data === hoje).length;
        }

        // FILTRO POR M√äS
        function filtrarMes() {
            const mesSelecionado = document.getElementById('filtroMes').value;
            if (!mesSelecionado) {
                renderOrders();
                document.getElementById('diasSemOs').innerHTML = '<li>Selecione um m√™s para visualizar</li>';
                atualizarGrafico(0);
                return;
            }

            const [ano, mes] = mesSelecionado.split('-').map(Number);

            const filtradas = orders.filter(o => {
                const d = new Date(o.data + 'T00:00:00');
                return d.getMonth() + 1 === mes && d.getFullYear() === ano;
            });

            renderOrders(filtradas);
            mostrarDiasSemOS(ano, mes);
            atualizarGrafico(ano, mes);
        }

        // DIAS SEM OS
        function diasSemApontamento(ano, mes) {
            const diasNoMes = new Date(ano, mes, 0).getDate();
            const diasEncontrados = orders
                .filter(o => {
                    const d = new Date(o.data + 'T00:00:00');
                    return d.getMonth() + 1 === mes && d.getFullYear() === ano;
                })
                .map(o => {
                    const dia = Number(o.data.split('-')[2]);
                    return dia;
                });

            const sem = [];
            for (let dia = 1; dia <= diasNoMes; dia++) {
                if (!diasEncontrados.includes(dia)) {
                    sem.push(dia);
                }
            }
            return sem;
        }

        function mostrarDiasSemOS(ano, mes) {
            const lista = diasSemApontamento(ano, mes);
            const elemento = document.getElementById('diasSemOs');

            if (lista.length === 0) {
                elemento.innerHTML = '<li>‚úÖ Todos os dias possuem O.S</li>';
            } else {
                elemento.innerHTML = lista.map(d => `<li>Dia ${d.toString().padStart(2, '0')}</li>`).join('');
            }
        }

        // GR√ÅFICO SVG (100% Offline)
        function atualizarGrafico(ano, mes) {
            if (!ano || !mes) {
                document.getElementById('percentText').textContent = '0%';
                document.getElementById('circleCom').setAttribute('stroke-dasharray', '0 502.4');
                document.getElementById('circleSem').setAttribute('stroke-dasharray', '502.4 502.4');
                return;
            }

            const totalDias = new Date(ano, mes, 0).getDate();
            const diasCom = orders.filter(o => {
                const d = new Date(o.data + 'T00:00:00');
                return d.getFullYear() === ano && d.getMonth() + 1 === mes;
            }).length;

            const porcent = Math.round((diasCom / totalDias) * 100);
            const circumference = 502.4; // 2 * Math.PI * 80
            const comLength = (porcent / 100) * circumference;
            const semLength = circumference - comLength;

            document.getElementById('percentText').textContent = porcent + '%';
            document.getElementById('circleCom').setAttribute('stroke-dasharray', `${comLength} ${circumference}`);
            document.getElementById('circleSem').setAttribute('stroke-dasharray', `${semLength} ${circumference}`);
            document.getElementById('circleSem').setAttribute('stroke-dashoffset', -comLength);
        }

        // Inicializa o sistema
        loadOrders();

        // Define data de hoje como padr√£o
        const hoje = new Date();
        const dataInput = document.getElementById('data');
        dataInput.valueAsDate = hoje;
    </script>
</body>
</html>
